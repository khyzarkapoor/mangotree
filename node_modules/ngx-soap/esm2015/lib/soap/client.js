/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/*
 * Copyright (c) 2011 Vinay Pulim <vinay@milewise.com>
 * MIT Licensed
 */
import * as assert from 'assert';
import * as events from 'events';
import * as util from 'util';
import { findPrefix } from './utils';
import * as _ from 'lodash';
import uuid4 from 'uuid/v4';
import { map } from 'rxjs/operators';
const /** @type {?} */ nonIdentifierChars = /[^a-z$_0-9]/i;
export const /** @type {?} */ Client = function (wsdl, endpoint, options) {
    events.EventEmitter.call(this);
    options = options || {};
    this.wsdl = wsdl;
    this._initializeOptions(options);
    this._initializeServices(endpoint);
    this.httpClient = /** @type {?} */ (options.httpClient);
    const /** @type {?} */ promiseOptions = { multiArgs: true };
    if (options.overridePromiseSuffix) {
        promiseOptions.suffix = options.overridePromiseSuffix;
    }
    Promise.all([this, promiseOptions]);
};
util.inherits(Client, events.EventEmitter);
Client.prototype.addSoapHeader = function (soapHeader, name, namespace, xmlns) {
    if (!this.soapHeaders) {
        this.soapHeaders = [];
    }
    if (typeof soapHeader === 'object') {
        soapHeader = this.wsdl.objectToXML(soapHeader, name, namespace, xmlns, true);
    }
    return this.soapHeaders.push(soapHeader) - 1;
};
Client.prototype.changeSoapHeader = function (index, soapHeader, name, namespace, xmlns) {
    if (!this.soapHeaders) {
        this.soapHeaders = [];
    }
    if (typeof soapHeader === 'object') {
        soapHeader = this.wsdl.objectToXML(soapHeader, name, namespace, xmlns, true);
    }
    this.soapHeaders[index] = soapHeader;
};
Client.prototype.getSoapHeaders = function () {
    return this.soapHeaders;
};
Client.prototype.clearSoapHeaders = function () {
    this.soapHeaders = null;
};
Client.prototype.addHttpHeader = function (name, value) {
    if (!this.httpHeaders) {
        this.httpHeaders = {};
    }
    this.httpHeaders[name] = value;
};
Client.prototype.getHttpHeaders = function () {
    return this.httpHeaders;
};
Client.prototype.clearHttpHeaders = function () {
    this.httpHeaders = {};
};
Client.prototype.addBodyAttribute = function (bodyAttribute, name, namespace, xmlns) {
    if (!this.bodyAttributes) {
        this.bodyAttributes = [];
    }
    if (typeof bodyAttribute === 'object') {
        let /** @type {?} */ composition = '';
        Object.getOwnPropertyNames(bodyAttribute).forEach(function (prop, idx, array) {
            composition += ' ' + prop + '="' + bodyAttribute[prop] + '"';
        });
        bodyAttribute = composition;
    }
    if (bodyAttribute.substr(0, 1) !== ' ')
        bodyAttribute = ' ' + bodyAttribute;
    this.bodyAttributes.push(bodyAttribute);
};
Client.prototype.getBodyAttributes = function () {
    return this.bodyAttributes;
};
Client.prototype.clearBodyAttributes = function () {
    this.bodyAttributes = null;
};
Client.prototype.setEndpoint = function (endpoint) {
    this.endpoint = endpoint;
    this._initializeServices(endpoint);
};
Client.prototype.describe = function () {
    const /** @type {?} */ types = this.wsdl.definitions.types;
    return this.wsdl.describeServices();
};
Client.prototype.setSecurity = function (security) {
    this.security = security;
};
Client.prototype.setSOAPAction = function (SOAPAction) {
    this.SOAPAction = SOAPAction;
};
Client.prototype._initializeServices = function (endpoint) {
    const /** @type {?} */ definitions = this.wsdl.definitions, /** @type {?} */
    services = definitions.services;
    for (const /** @type {?} */ name in services) {
        this[name] = this._defineService(services[name], endpoint);
    }
};
Client.prototype._initializeOptions = function (options) {
    this.streamAllowed = options.stream;
    this.normalizeNames = options.normalizeNames;
    this.wsdl.options.attributesKey = options.attributesKey || 'attributes';
    this.wsdl.options.envelopeKey = options.envelopeKey || 'soap';
    this.wsdl.options.preserveWhitespace = !!options.preserveWhitespace;
    if (options.ignoredNamespaces !== undefined) {
        if (options.ignoredNamespaces.override !== undefined) {
            if (options.ignoredNamespaces.override === true) {
                if (options.ignoredNamespaces.namespaces !== undefined) {
                    this.wsdl.options.ignoredNamespaces = options.ignoredNamespaces.namespaces;
                }
            }
        }
    }
    if (options.overrideRootElement !== undefined) {
        this.wsdl.options.overrideRootElement = options.overrideRootElement;
    }
    this.wsdl.options.forceSoap12Headers = !!options.forceSoap12Headers;
};
Client.prototype._defineService = function (service, endpoint) {
    const /** @type {?} */ ports = service.ports, /** @type {?} */
    def = {};
    for (const /** @type {?} */ name in ports) {
        def[name] = this._definePort(ports[name], endpoint ? endpoint : ports[name].location);
    }
    return def;
};
Client.prototype._definePort = function (port, endpoint) {
    const /** @type {?} */ location = endpoint, /** @type {?} */
    binding = port.binding, /** @type {?} */
    methods = binding.methods, /** @type {?} */
    def = {};
    for (const /** @type {?} */ name in methods) {
        def[name] = this._defineMethod(methods[name], location);
        const /** @type {?} */ methodName = this.normalizeNames ? name.replace(nonIdentifierChars, '_') : name;
        this[methodName] = def[name];
    }
    return def;
};
Client.prototype._defineMethod = function (method, location) {
    const /** @type {?} */ self = this;
    let /** @type {?} */ temp = null;
    return function (args, callback, options, extraHeaders) {
        if (typeof args === 'function') {
            callback = args;
            args = {};
        }
        else if (typeof options === 'function') {
            temp = callback;
            callback = options;
            options = temp;
        }
        else if (typeof extraHeaders === 'function') {
            temp = callback;
            callback = extraHeaders;
            extraHeaders = options;
            options = temp;
        }
        // self._invoke(method, args, location, function(error, result, rawResponse, soapHeader, rawRequest) {
        //   callback(error, result, rawResponse, soapHeader, rawRequest);
        // }, options, extraHeaders);
        return self._invoke(method, args, location, options, extraHeaders);
    };
};
Client.prototype._invoke = function (method, args, location, options, extraHeaders) {
    let /** @type {?} */ self = this, /** @type {?} */
    name = method.$name, /** @type {?} */
    input = method.input, /** @type {?} */
    output = method.output, /** @type {?} */
    style = method.style, /** @type {?} */
    defs = this.wsdl.definitions, /** @type {?} */
    envelopeKey = this.wsdl.options.envelopeKey, /** @type {?} */
    ns = defs.$targetNamespace, /** @type {?} */
    encoding = '', /** @type {?} */
    message = '', /** @type {?} */
    xml = null, /** @type {?} */
    req = null, /** @type {?} */
    soapAction = null, /** @type {?} */
    alias = findPrefix(defs.xmlns, ns), /** @type {?} */
    headers = {
        "Content-Type": "text/xml; charset=utf-8"
    }, /** @type {?} */
    xmlnsSoap = "xmlns:" + envelopeKey + "=\"http://schemas.xmlsoap.org/soap/envelope/\"";
    if (this.wsdl.options.forceSoap12Headers) {
        headers["Content-Type"] = "application/soap+xml; charset=utf-8";
        xmlnsSoap = "xmlns:" + envelopeKey + "=\"http://www.w3.org/2003/05/soap-envelope\"";
    }
    if (this.SOAPAction) {
        soapAction = this.SOAPAction;
    }
    else if (method.soapAction !== undefined && method.soapAction !== null) {
        soapAction = method.soapAction;
    }
    else {
        soapAction = ((ns.lastIndexOf("/") !== ns.length - 1) ? ns + "/" : ns) + name;
    }
    if (!this.wsdl.options.forceSoap12Headers) {
        headers.SOAPAction = '"' + soapAction + '"';
    }
    options = options || {};
    //Add extra headers
    for (const /** @type {?} */ header in this.httpHeaders) {
        headers[header] = this.httpHeaders[header];
    }
    for (const /** @type {?} */ attr in extraHeaders) {
        headers[attr] = extraHeaders[attr];
    }
    // Allow the security object to add headers
    if (self.security && self.security.addHeaders)
        self.security.addHeaders(headers);
    if (self.security && self.security.addOptions)
        self.security.addOptions(options);
    if ((style === 'rpc') && ((input.parts || input.name === "element") || args === null)) {
        assert.ok(!style || style === 'rpc', 'invalid message definition for document style binding');
        message = self.wsdl.objectToRpcXML(name, args, alias, ns, (input.name !== "element"));
        (method.inputSoap === 'encoded') && (encoding = 'soap:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/" ');
    }
    else {
        assert.ok(!style || style === 'document', 'invalid message definition for rpc style binding');
        // pass `input.$lookupType` if `input.$type` could not be found
        message = self.wsdl.objectToDocumentXML(input.$name, args, input.targetNSAlias, input.targetNamespace, (input.$type || input.$lookupType));
    }
    xml = "<?xml version=\"1.0\" encoding=\"utf-8\"?>" +
        "<" + envelopeKey + ":Envelope " +
        xmlnsSoap + " " +
        "xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" " +
        encoding +
        this.wsdl.xmlnsInEnvelope + '>' +
        ((self.soapHeaders || self.security) ?
            ("<" + envelopeKey + ":Header>" +
                (self.soapHeaders ? self.soapHeaders.join("\n") : "") +
                (self.security && !self.security.postProcess ? self.security.toXML() : "") +
                "</" + envelopeKey + ":Header>")
            :
                '') +
        "<" + envelopeKey + ":Body" +
        (self.bodyAttributes ? self.bodyAttributes.join(' ') : '') +
        (self.security && self.security.postProcess ? ' Id="_0"' : '') +
        ">" +
        message +
        "</" + envelopeKey + ":Body>" +
        "</" + envelopeKey + ":Envelope>";
    if (self.security && self.security.postProcess) {
        xml = self.security.postProcess(xml, envelopeKey);
    }
    if (options && options.postProcess) {
        xml = options.postProcess(xml);
    }
    self.lastMessage = message;
    self.lastRequest = xml;
    self.lastEndpoint = location;
    const /** @type {?} */ eid = options.exchangeId || uuid4();
    self.emit('message', message, eid);
    self.emit('request', xml, eid);
    const /** @type {?} */ tryJSONparse = function (body) {
        try {
            return JSON.parse(body);
        }
        catch (/** @type {?} */ err) {
            return undefined;
        }
    };
    // if (this.streamAllowed && typeof self.httpClient.requestStream === 'function') {
    //   callback = _.once(callback);
    //   const startTime = Date.now();
    //   req = self.httpClient.requestStream(location, xml, headers, options, self);
    //   self.lastRequestHeaders = req.headers;
    //   const onError = function onError(err) {
    //     self.lastResponse = null;
    //     self.lastResponseHeaders = null;
    //     self.lastElapsedTime = null;
    //     self.emit('response', null, null, eid);
    //     callback(err, undefined, undefined, undefined, xml);
    //   };
    //   req.on('error', onError);
    //   req.on('response', function (response) {
    //     response.on('error', onError);
    //     // When the output element cannot be looked up in the wsdl, play it safe and
    //     // don't stream
    //     if(response.statusCode !== 200 || !output || !output.$lookupTypes) {
    //       console.log("TODO! response handling");
    //       // response.pipe(concatStream({encoding: 'string'}, function (body) {
    //       //   self.lastResponse = body;
    //       //   self.lastResponseHeaders = response && response.headers;
    //       //   self.lastElapsedTime = Date.now() - startTime;
    //       //   self.emit('response', body, response, eid);
    //       //   return parseSync(body, response);
    //       // }));
    //       return;
    //     }
    //     self.wsdl.xmlToObject(response, function (error, obj) {
    //       self.lastResponse = response;
    //       self.lastResponseHeaders = response && response.headers;
    //       self.lastElapsedTime = Date.now() - startTime;
    //       self.emit('response', '<stream>', response, eid);
    //       if (error) {
    //         error.response = response;
    //         error.body = '<stream>';
    //         self.emit('soapError', error, eid);
    //         return callback(error, response, undefined, undefined, xml);
    //       }
    //       return finish(obj, '<stream>', response);
    //     });
    //   });
    //   return;
    // }
    return (/** @type {?} */ (self.httpClient)).post(location, xml, {
        headers: headers,
        responseType: 'text', observe: 'response'
    }).pipe(map((response) => {
        self.lastResponse = response.body;
        self.lastResponseHeaders = response && response.headers;
        // self.lastElapsedTime = response && response.elapsedTime;
        self.emit('response', response.body, response, eid);
        return parseSync(response.body, response);
    }));
    /**
     * @param {?} body
     * @param {?} response
     * @return {?}
     */
    function parseSync(body, response) {
        let /** @type {?} */ obj;
        try {
            obj = self.wsdl.xmlToObject(body);
        }
        catch (/** @type {?} */ error) {
            //  When the output element cannot be looked up in the wsdl and the body is JSON
            //  instead of sending the error, we pass the body in the response.
            if (!output || !output.$lookupTypes) {
                // debug('Response element is not present. Unable to convert response xml to json.');
                //  If the response is JSON then return it as-is.
                const /** @type {?} */ json = _.isObject(body) ? body : tryJSONparse(body);
                if (json) {
                    return { err: null, response, responseBody: json, header: undefined, xml }; //callback(null, response, json, undefined, xml);
                }
            }
            error.response = response;
            error.body = body;
            self.emit('soapError', error, eid);
            throw error; //callback(error, response, body, undefined, xml);
        }
        return finish(obj, body, response);
    }
    /**
     * @param {?} obj
     * @param {?} responseBody
     * @param {?} response
     * @return {?}
     */
    function finish(obj, responseBody, response) {
        let /** @type {?} */ result = null;
        if (!output) {
            // one-way, no output expected
            return { err: null, response: null, responseBody, header: obj.Header, xml }; //callback(null, null, body, obj.Header, xml);
        }
        // If it's not HTML and Soap Body is empty
        if (!obj.html && !obj.Body) {
            return { err: null, obj, responseBody, header: obj.Header, xml };
            //callback(null, obj, body, obj.Header);
        }
        if (typeof obj.Body !== 'object') {
            const /** @type {?} */ error = new Error('Cannot parse response');
            error.response = response;
            error.body = responseBody;
            return { err: error, obj, responseBody, header: undefined, xml };
            //callback(error, obj, body, undefined, xml);
        }
        result = obj.Body[output.$name];
        // RPC/literal response body may contain elements with added suffixes I.E.
        // 'Response', or 'Output', or 'Out'
        // This doesn't necessarily equal the ouput message name. See WSDL 1.1 Section 2.4.5
        if (!result) {
            result = obj.Body[output.$name.replace(/(?:Out(?:put)?|Response)$/, '')];
        }
        if (!result) {
            ['Response', 'Out', 'Output'].forEach(function (term) {
                if (obj.Body.hasOwnProperty(name + term)) {
                    return result = obj.Body[name + term];
                }
            });
        }
        return { err: null, result, responseBody, header: obj.Header, xml };
        //callback(null, result, body, obj.Header, xml);
    }
    // // Added mostly for testability, but possibly useful for debugging
    // if(req && req.headers && !options.ntlm) //fixes an issue when req or req.headers is undefined, doesn't apply to ntlm requests
    //   self.lastRequestHeaders = req.headers;
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXNvYXAvIiwic291cmNlcyI6WyJsaWIvc29hcC9jbGllbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFPQSxPQUFPLEtBQUssTUFBTSxNQUFNLFFBQVEsQ0FBQztBQUNqQyxPQUFPLEtBQUssTUFBTSxNQUFNLFFBQVEsQ0FBQztBQUNqQyxPQUFPLEtBQUssSUFBSSxNQUFNLE1BQU0sQ0FBQztBQUU3QixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQ3JDLE9BQU8sS0FBSyxDQUFDLE1BQU0sUUFBUSxDQUFDO0FBRTVCLE9BQU8sS0FBSyxNQUFNLFNBQVMsQ0FBQztBQUU1QixPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFckMsdUJBQU0sa0JBQWtCLEdBQUcsY0FBYyxDQUFDO0FBRTFDLE1BQU0sQ0FBQyx1QkFBTSxNQUFNLEdBQUcsVUFBUyxJQUFJLEVBQUUsUUFBUSxFQUFFLE9BQU87SUFDcEQsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDL0IsT0FBTyxHQUFHLE9BQU8sSUFBSSxFQUFFLENBQUM7SUFDeEIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7SUFDakIsSUFBSSxDQUFDLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ2pDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUNuQyxJQUFJLENBQUMsVUFBVSxxQkFBRyxPQUFPLENBQUMsVUFBd0IsQ0FBQSxDQUFDO0lBQ25ELHVCQUFNLGNBQWMsR0FBUSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQztJQUNoRCxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDO1FBQ2xDLGNBQWMsQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDLHFCQUFxQixDQUFDO0tBQ3ZE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Q0FBQyxDQUFDO0tBQUc7SUFDeEYsR0FBRyxDQUFDLENBQUMsdUJBQU0sSUFBSSxJQUFJLFlBQVksQ0FBQyxDQUFDLENBQUM7UUFBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO0tBQUU7O0lBR3hFLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUM7UUFDNUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDcEMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQztRQUM1QyxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUVwQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyxLQUFLLENBQUMsSUFBRyxDQUFFLENBQUUsS0FBSyxDQUFDLEtBQUssSUFBSSxLQUFLLENBQUMsSUFBSSxLQUFHLFNBQVMsQ0FBRSxJQUFJLElBQUksS0FBSyxJQUFJLENBQUUsQ0FBQyxDQUFDLENBQUM7UUFDdkYsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssSUFBSSxLQUFLLEtBQUssS0FBSyxFQUFFLHVEQUF1RCxDQUFDLENBQUM7UUFDOUYsT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLEtBQUcsU0FBUyxDQUFFLENBQUMsQ0FBQztRQUNwRixDQUFDLE1BQU0sQ0FBQyxTQUFTLEtBQUssU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLEdBQUcsaUVBQWlFLENBQUMsQ0FBQztLQUNwSDtJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ04sTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssSUFBSSxLQUFLLEtBQUssVUFBVSxFQUFF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LENBQUMsdUJBQXVCLENBQUMsQ0FBQztZQUN0RCxLQUFLLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztZQUMxQixLQUFLLENBQUMsSUFBSSxHQUFHLFlBQVksQ0FBQztZQUMxQixNQUFNLENBQUMsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsQ0FBQzs7U0FFbEU7UUFFRCxNQUFNLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7Ozs7UUFJaEMsRUFBRSxDQUFBLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQSxDQUFDO1lBQ1YsTUFBTSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsMkJBQTJCLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztTQUMxRTtRQUNELEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUNaLENBQUMsVUFBVSxFQUFFLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBVSxJQUFJO2dCQUNsRCxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUN6QyxNQUFNLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFDO2lCQUN2QzthQUNGLENBQUMsQ0FBQztTQUNKO1FBRUQsTUFBTSxDQUFDLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxDQUFDOztLQUVyRTs7OztDQUtGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IChjKSAyMDExIFZpbmF5IFB1bGltIDx2aW5heUBtaWxld2lzZS5jb20+XG4gKiBNSVQgTGljZW5zZWRcbiAqL1xuXG4vLyBpbXBvcnQgeyBIdHRwQ2xpZW50IH3CoGZyb20gJy4vaHR0cCc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwUmVzcG9uc2UgfcKgZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0ICogYXMgYXNzZXJ0IGZyb20gJ2Fzc2VydCc7XG5pbXBvcnQgKiBhcyBldmVudHMgZnJvbSAnZXZlbnRzJztcbmltcG9ydCAqIGFzIHV0aWwgZnJvbSAndXRpbCc7XG4gIC8vIGRlYnVnID0gcmVxdWlyZSgnZGVidWcnKSgnbm9kZS1zb2FwJyk7XG5pbXBvcnQgeyBmaW5kUHJlZml4IH0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XG4vLyBpbXBvcnQgY29uY2F0U3RyZWFtIGZyb20gJ2NvbmNhdC1zdHJlYW0nO1xuaW1wb3J0IHV1aWQ0IGZyb20gJ3V1aWQvdjQnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5jb25zdCBub25JZGVudGlmaWVyQ2hhcnMgPSAvW15hLXokXzAtOV0vaTtcblxuZXhwb3J0IGNvbnN0IENsaWVudCA9IGZ1bmN0aW9uKHdzZGwsIGVuZHBvaW50LCBvcHRpb25zKSB7XG4gIGV2ZW50cy5FdmVudEVtaXR0ZXIuY2FsbCh0aGlzKTtcbiAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gIHRoaXMud3NkbCA9IHdzZGw7XG4gIHRoaXMuX2luaXRpYWxpemVPcHRpb25zKG9wdGlvbnMpO1xuICB0aGlzLl9pbml0aWFsaXplU2VydmljZXMoZW5kcG9pbnQpO1xuICB0aGlzLmh0dHBDbGllbnQgPSBvcHRpb25zLmh0dHBDbGllbnQgYXMgSHR0cENsaWVudDtcbiAgY29uc3QgcHJvbWlzZU9wdGlvbnM6IGFueSA9IHsgbXVsdGlBcmdzOiB0cnVlIH07XG4gIGlmIChvcHRpb25zLm92ZXJyaWRlUHJvbWlzZVN1ZmZpeCkge1xuICAgIHByb21pc2VPcHRpb25zLnN1ZmZpeCA9IG9wdGlvbnMub3ZlcnJpZGVQcm9taXNlU3VmZml4O1xuICB9XG4gIFByb21pc2UuYWxsKFt0aGlzLCBwcm9taXNlT3B0aW9uc10pO1xufTtcbnV0aWwuaW5oZXJpdHMoQ2xpZW50LCBldmVudHMuRXZlbnRFbWl0dGVyKTtcblxuQ2xpZW50LnByb3RvdHlwZS5hZGRTb2FwSGVhZGVyID0gZnVuY3Rpb24oc29hcEhlYWRlciwgbmFtZSwgbmFtZXNwYWNlLCB4bWxucykge1xuICBpZiAoIXRoaXMuc29hcEhlYWRlcnMpIHtcbiAgICB0aGlzLnNvYXBIZWFkZXJzID0gW107XG4gIH1cbiAgaWYgKHR5cGVvZiBzb2FwSGVhZGVyID09PSAnb2JqZWN0Jykge1xuICAgIHNvYXBIZWFkZXIgPSB0aGlzLndzZGwub2JqZWN0VG9YTUwoc29hcEhlYWRlciwgbmFtZSwgbmFtZXNwYWNlLCB4bWxucywgdHJ1ZSk7XG4gIH1cbiAgcmV0dXJuIHRoaXMuc29hcEhlYWRlcnMucHVzaChzb2FwSGVhZGVyKSAtIDE7XG59O1xuXG5DbGllbnQucHJvdG90eXBlLmNoYW5nZVNvYXBIZWFkZXIgPSBmdW5jdGlvbihpbmRleCwgc29hcEhlYWRlciwgbmFtZSwgbmFtZXNwYWNlLCB4bWxucykge1xuICBpZiAoIXRoaXMuc29hcEhlYWRlcnMpIHtcbiAgICB0aGlzLnNvYXBIZWFkZXJzID0gW107XG4gIH1cbiAgaWYgKHR5cGVvZiBzb2FwSGVhZGVyID09PSAnb2JqZWN0Jykge1xuICAgIHNvYXBIZWFkZXIgPSB0aGlzLndzZGwub2JqZWN0VG9YTUwoc29hcEhlYWRlciwgbmFtZSwgbmFtZXNwYWNlLCB4bWxucywgdHJ1ZSk7XG4gIH1cbiAgdGhpcy5zb2FwSGVhZGVyc1tpbmRleF0gPSBzb2FwSGVhZGVyO1xufTtcblxuQ2xpZW50LnByb3RvdHlwZS5nZXRTb2FwSGVhZGVycyA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gdGhpcy5zb2FwSGVhZGVycztcbn07XG5cbkNsaWVudC5wcm90b3R5cGUuY2xlYXJTb2FwSGVhZGVycyA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLnNvYXBIZWFkZXJzID0gbnVsbDtcbn07XG5cbkNsaWVudC5wcm90b3R5cGUuYWRkSHR0cEhlYWRlciA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gIGlmICghdGhpcy5odHRwSGVhZGVycykge1xuICAgIHRoaXMuaHR0cEhlYWRlcnMgPSB7fTtcbiAgfVxuICB0aGlzLmh0dHBIZWFkZXJzW25hbWVdID0gdmFsdWU7XG59O1xuXG5DbGllbnQucHJvdG90eXBlLmdldEh0dHBIZWFkZXJzID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiB0aGlzLmh0dHBIZWFkZXJzO1xufTtcblxuQ2xpZW50LnByb3RvdHlwZS5jbGVhckh0dHBIZWFkZXJzID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuaHR0cEhlYWRlcnMgPSB7fTtcbn07XG5cblxuQ2xpZW50LnByb3RvdHlwZS5hZGRCb2R5QXR0cmlidXRlID0gZnVuY3Rpb24oYm9keUF0dHJpYnV0ZSwgbmFtZSwgbmFtZXNwYWNlLCB4bWxucykge1xuICBpZiAoIXRoaXMuYm9keUF0dHJpYnV0ZXMpIHtcbiAgICB0aGlzLmJvZHlBdHRyaWJ1dGVzID0gW107XG4gIH1cbiAgaWYgKHR5cGVvZiBib2R5QXR0cmlidXRlID09PSAnb2JqZWN0Jykge1xuICAgIGxldCBjb21wb3NpdGlvbiA9ICcnO1xuICAgIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGJvZHlBdHRyaWJ1dGUpLmZvckVhY2goZnVuY3Rpb24ocHJvcCwgaWR4LCBhcnJheSkge1xuICAgICAgY29tcG9zaXRpb24gKz0gJyAnICsgcHJvcCArICc9XCInICsgYm9keUF0dHJpYnV0ZVtwcm9wXSArICdcIic7XG4gICAgfSk7XG4gICAgYm9keUF0dHJpYnV0ZSA9IGNvbXBvc2l0aW9uO1xuICB9XG4gIGlmIChib2R5QXR0cmlidXRlLnN1YnN0cigwLCAxKSAhPT0gJyAnKSBib2R5QXR0cmlidXRlID0gJyAnICsgYm9keUF0dHJpYnV0ZTtcbiAgdGhpcy5ib2R5QXR0cmlidXRlcy5wdXNoKGJvZHlBdHRyaWJ1dGUpO1xufTtcblxuQ2xpZW50LnByb3RvdHlwZS5nZXRCb2R5QXR0cmlidXRlcyA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gdGhpcy5ib2R5QXR0cmlidXRlcztcbn07XG5cbkNsaWVudC5wcm90b3R5cGUuY2xlYXJCb2R5QXR0cmlidXRlcyA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmJvZHlBdHRyaWJ1dGVzID0gbnVsbDtcbn07XG5cbkNsaWVudC5wcm90b3R5cGUuc2V0RW5kcG9pbnQgPSBmdW5jdGlvbihlbmRwb2ludCkge1xuICB0aGlzLmVuZHBvaW50ID0gZW5kcG9pbnQ7XG4gIHRoaXMuX2luaXRpYWxpemVTZXJ2aWNlcyhlbmRwb2ludCk7XG59O1xuXG5DbGllbnQucHJvdG90eXBlLmRlc2NyaWJlID0gZnVuY3Rpb24oKSB7XG4gIGNvbnN0IHR5cGVzID0gdGhpcy53c2RsLmRlZmluaXRpb25zLnR5cGVzO1xuICByZXR1cm4gdGhpcy53c2RsLmRlc2NyaWJlU2VydmljZXMoKTtcbn07XG5cbkNsaWVudC5wcm90b3R5cGUuc2V0U2VjdXJpdHkgPSBmdW5jdGlvbihzZWN1cml0eSkge1xuICB0aGlzLnNlY3VyaXR5ID0gc2VjdXJpdHk7XG59O1xuXG5DbGllbnQucHJvdG90eXBlLnNldFNPQVBBY3Rpb24gPSBmdW5jdGlvbihTT0FQQWN0aW9uKSB7XG4gIHRoaXMuU09BUEFjdGlvbiA9IFNPQVBBY3Rpb247XG59O1xuXG5DbGllbnQucHJvdG90eXBlLl9pbml0aWFsaXplU2VydmljZXMgPSBmdW5jdGlvbihlbmRwb2ludCkge1xuICBjb25zdCBkZWZpbml0aW9ucyA9IHRoaXMud3NkbC5kZWZpbml0aW9ucyxcbiAgICBzZXJ2aWNlcyA9IGRlZmluaXRpb25zLnNlcnZpY2VzO1xuICBmb3IgKGNvbnN0IG5hbWUgaW4gc2VydmljZXMpIHtcbiAgICB0aGlzW25hbWVdID0gdGhpcy5fZGVmaW5lU2VydmljZShzZXJ2aWNlc1tuYW1lXSwgZW5kcG9pbnQpO1xuICB9XG59O1xuXG5DbGllbnQucHJvdG90eXBlLl9pbml0aWFsaXplT3B0aW9ucyA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgdGhpcy5zdHJlYW1BbGxvd2VkID0gb3B0aW9ucy5zdHJlYW07XG4gIHRoaXMubm9ybWFsaXplTmFtZXMgPSBvcHRpb25zLm5vcm1hbGl6ZU5hbWVzO1xuICB0aGlzLndzZGwub3B0aW9ucy5hdHRyaWJ1dGVzS2V5ID0gb3B0aW9ucy5hdHRyaWJ1dGVzS2V5IHx8ICdhdHRyaWJ1dGVzJztcbiAgdGhpcy53c2RsLm9wdGlvbnMuZW52ZWxvcGVLZXkgPSBvcHRpb25zLmVudmVsb3BlS2V5IHx8ICdzb2FwJztcbiAgdGhpcy53c2RsLm9wdGlvbnMucHJlc2VydmVXaGl0ZXNwYWNlID0gISFvcHRpb25zLnByZXNlcnZlV2hpdGVzcGFjZTtcbiAgaWYob3B0aW9ucy5pZ25vcmVkTmFtZXNwYWNlcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgaWYob3B0aW9ucy5pZ25vcmVkTmFtZXNwYWNlcy5vdmVycmlkZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBpZihvcHRpb25zLmlnbm9yZWROYW1lc3BhY2VzLm92ZXJyaWRlID09PSB0cnVlKSB7XG4gICAgICAgIGlmKG9wdGlvbnMuaWdub3JlZE5hbWVzcGFjZXMubmFtZXNwYWNlcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgdGhpcy53c2RsLm9wdGlvbnMuaWdub3JlZE5hbWVzcGFjZXMgPSBvcHRpb25zLmlnbm9yZWROYW1lc3BhY2VzLm5hbWVzcGFjZXM7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgaWYob3B0aW9ucy5vdmVycmlkZVJvb3RFbGVtZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICB0aGlzLndzZGwub3B0aW9ucy5vdmVycmlkZVJvb3RFbGVtZW50ID0gb3B0aW9ucy5vdmVycmlkZVJvb3RFbGVtZW50O1xuICB9XG4gIHRoaXMud3NkbC5vcHRpb25zLmZvcmNlU29hcDEySGVhZGVycyA9ICEhb3B0aW9ucy5mb3JjZVNvYXAxMkhlYWRlcnM7XG59O1xuXG5DbGllbnQucHJvdG90eXBlLl9kZWZpbmVTZXJ2aWNlID0gZnVuY3Rpb24oc2VydmljZSwgZW5kcG9pbnQpIHtcbiAgY29uc3QgcG9ydHMgPSBzZXJ2aWNlLnBvcnRzLFxuICAgIGRlZiA9IHt9O1xuICBmb3IgKGNvbnN0IG5hbWUgaW4gcG9ydHMpIHtcbiAgICBkZWZbbmFtZV0gPSB0aGlzLl9kZWZpbmVQb3J0KHBvcnRzW25hbWVdLCBlbmRwb2ludCA/IGVuZHBvaW50IDogcG9ydHNbbmFtZV0ubG9jYXRpb24pO1xuICB9XG4gIHJldHVybiBkZWY7XG59O1xuXG5DbGllbnQucHJvdG90eXBlLl9kZWZpbmVQb3J0ID0gZnVuY3Rpb24ocG9ydCwgZW5kcG9pbnQpIHtcbiAgY29uc3QgbG9jYXRpb24gPSBlbmRwb2ludCxcbiAgICBiaW5kaW5nID0gcG9ydC5iaW5kaW5nLFxuICAgIG1ldGhvZHMgPSBiaW5kaW5nLm1ldGhvZHMsXG4gICAgZGVmID0ge307XG4gIGZvciAoY29uc3QgbmFtZSBpbiBtZXRob2RzKSB7XG4gICAgZGVmW25hbWVdID0gdGhpcy5fZGVmaW5lTWV0aG9kKG1ldGhvZHNbbmFtZV0sIGxvY2F0aW9uKTtcbiAgICBjb25zdCBtZXRob2ROYW1lID0gdGhpcy5ub3JtYWxpemVOYW1lcyA/IG5hbWUucmVwbGFjZShub25JZGVudGlmaWVyQ2hhcnMsICdfJykgOiBuYW1lO1xuICAgIHRoaXNbbWV0aG9kTmFtZV0gPSBkZWZbbmFtZV07XG4gIH1cbiAgcmV0dXJuIGRlZjtcbn07XG5cbkNsaWVudC5wcm90b3R5cGUuX2RlZmluZU1ldGhvZCA9IGZ1bmN0aW9uKG1ldGhvZCwgbG9jYXRpb24pIHtcbiAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gIGxldCB0ZW1wID0gbnVsbDtcbiAgcmV0dXJuIGZ1bmN0aW9uKGFyZ3MsIGNhbGxiYWNrLCBvcHRpb25zLCBleHRyYUhlYWRlcnMpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIGlmICh0eXBlb2YgYXJncyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgY2FsbGJhY2sgPSBhcmdzO1xuICAgICAgYXJncyA9IHt9O1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHRlbXAgPSBjYWxsYmFjaztcbiAgICAgIGNhbGxiYWNrID0gb3B0aW9ucztcbiAgICAgIG9wdGlvbnMgPSB0ZW1wO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGV4dHJhSGVhZGVycyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGVtcCA9IGNhbGxiYWNrO1xuICAgICAgY2FsbGJhY2sgPSBleHRyYUhlYWRlcnM7XG4gICAgICBleHRyYUhlYWRlcnMgPSBvcHRpb25zO1xuICAgICAgb3B0aW9ucyA9IHRlbXA7XG4gICAgfVxuICAgIC8vIHNlbGYuX2ludm9rZShtZXRob2QsIGFyZ3MsIGxvY2F0aW9uLCBmdW5jdGlvbihlcnJvciwgcmVzdWx0LCByYXdSZXNwb25zZSwgc29hcEhlYWRlciwgcmF3UmVxdWVzdCkge1xuICAgIC8vICAgY2FsbGJhY2soZXJyb3IsIHJlc3VsdCwgcmF3UmVzcG9uc2UsIHNvYXBIZWFkZXIsIHJhd1JlcXVlc3QpO1xuICAgIC8vIH0sIG9wdGlvbnMsIGV4dHJhSGVhZGVycyk7XG5cbiAgICByZXR1cm4gc2VsZi5faW52b2tlKG1ldGhvZCwgYXJncywgbG9jYXRpb24sIG9wdGlvbnMsIGV4dHJhSGVhZGVycyk7XG4gIH07XG59O1xuXG5DbGllbnQucHJvdG90eXBlLl9pbnZva2UgPSBmdW5jdGlvbihtZXRob2QsIGFyZ3MsIGxvY2F0aW9uLCBvcHRpb25zLCBleHRyYUhlYWRlcnMpOiBPYnNlcnZhYmxlPGFueT4ge1xuICBsZXQgc2VsZiA9IHRoaXMsXG4gICAgbmFtZSA9IG1ldGhvZC4kbmFtZSxcbiAgICBpbnB1dCA9IG1ldGhvZC5pbnB1dCxcbiAgICBvdXRwdXQgPSBtZXRob2Qub3V0cHV0LFxuICAgIHN0eWxlID0gbWV0aG9kLnN0eWxlLFxuICAgIGRlZnMgPSB0aGlzLndzZGwuZGVmaW5pdGlvbnMsXG4gICAgZW52ZWxvcGVLZXkgPSB0aGlzLndzZGwub3B0aW9ucy5lbnZlbG9wZUtleSxcbiAgICBucyA9IGRlZnMuJHRhcmdldE5hbWVzcGFjZSxcbiAgICBlbmNvZGluZyA9ICcnLFxuICAgIG1lc3NhZ2UgPSAnJyxcbiAgICB4bWwgPSBudWxsLFxuICAgIHJlcSA9IG51bGwsXG4gICAgc29hcEFjdGlvbiA9IG51bGwsXG4gICAgYWxpYXMgPSBmaW5kUHJlZml4KGRlZnMueG1sbnMsIG5zKSxcbiAgICBoZWFkZXJzOiBhbnkgPSB7XG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcInRleHQveG1sOyBjaGFyc2V0PXV0Zi04XCJcbiAgICB9LFxuICAgIHhtbG5zU29hcCA9IFwieG1sbnM6XCIgKyBlbnZlbG9wZUtleSArIFwiPVxcXCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy9zb2FwL2VudmVsb3BlL1xcXCJcIjtcblxuICBpZiAodGhpcy53c2RsLm9wdGlvbnMuZm9yY2VTb2FwMTJIZWFkZXJzKSB7XG4gICAgaGVhZGVyc1tcIkNvbnRlbnQtVHlwZVwiXSA9IFwiYXBwbGljYXRpb24vc29hcCt4bWw7IGNoYXJzZXQ9dXRmLThcIjtcbiAgICB4bWxuc1NvYXAgPSBcInhtbG5zOlwiICsgZW52ZWxvcGVLZXkgKyBcIj1cXFwiaHR0cDovL3d3dy53My5vcmcvMjAwMy8wNS9zb2FwLWVudmVsb3BlXFxcIlwiO1xuICB9XG5cbiAgaWYgKHRoaXMuU09BUEFjdGlvbikge1xuICAgIHNvYXBBY3Rpb24gPSB0aGlzLlNPQVBBY3Rpb247XG4gIH0gZWxzZSBpZiAobWV0aG9kLnNvYXBBY3Rpb24gIT09IHVuZGVmaW5lZCAmJiBtZXRob2Quc29hcEFjdGlvbiAhPT0gbnVsbCkge1xuICAgIHNvYXBBY3Rpb24gPSBtZXRob2Quc29hcEFjdGlvbjtcbiAgfSBlbHNlIHtcbiAgICBzb2FwQWN0aW9uID0gKChucy5sYXN0SW5kZXhPZihcIi9cIikgIT09IG5zLmxlbmd0aCAtIDEpID8gbnMgKyBcIi9cIiA6IG5zKSArIG5hbWU7XG4gIH1cblxuICBpZiAoIXRoaXMud3NkbC5vcHRpb25zLmZvcmNlU29hcDEySGVhZGVycykge1xuICAgIGhlYWRlcnMuU09BUEFjdGlvbiA9ICdcIicgKyBzb2FwQWN0aW9uICsgJ1wiJztcbiAgfVxuXG4gIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG4gIC8vQWRkIGV4dHJhIGhlYWRlcnNcbiAgZm9yIChjb25zdCBoZWFkZXIgaW4gdGhpcy5odHRwSGVhZGVycyApIHsgaGVhZGVyc1toZWFkZXJdID0gdGhpcy5odHRwSGVhZGVyc1toZWFkZXJdOyAgfVxuICBmb3IgKGNvbnN0IGF0dHIgaW4gZXh0cmFIZWFkZXJzKSB7IGhlYWRlcnNbYXR0cl0gPSBleHRyYUhlYWRlcnNbYXR0cl07IH1cblxuICAvLyBBbGxvdyB0aGUgc2VjdXJpdHkgb2JqZWN0IHRvIGFkZCBoZWFkZXJzXG4gIGlmIChzZWxmLnNlY3VyaXR5ICYmIHNlbGYuc2VjdXJpdHkuYWRkSGVhZGVycylcbiAgICBzZWxmLnNlY3VyaXR5LmFkZEhlYWRlcnMoaGVhZGVycyk7XG4gIGlmIChzZWxmLnNlY3VyaXR5ICYmIHNlbGYuc2VjdXJpdHkuYWRkT3B0aW9ucylcbiAgICBzZWxmLnNlY3VyaXR5LmFkZE9wdGlvbnMob3B0aW9ucyk7XG5cbiAgaWYgKChzdHlsZSA9PT0gJ3JwYycpJiYgKCAoIGlucHV0LnBhcnRzIHx8IGlucHV0Lm5hbWU9PT1cImVsZW1lbnRcIiApIHx8IGFyZ3MgPT09IG51bGwpICkge1xuICAgIGFzc2VydC5vayghc3R5bGUgfHwgc3R5bGUgPT09ICdycGMnLCAnaW52YWxpZCBtZXNzYWdlIGRlZmluaXRpb24gZm9yIGRvY3VtZW50IHN0eWxlIGJpbmRpbmcnKTtcbiAgICBtZXNzYWdlID0gc2VsZi53c2RsLm9iamVjdFRvUnBjWE1MKG5hbWUsIGFyZ3MsIGFsaWFzLCBucywoaW5wdXQubmFtZSE9PVwiZWxlbWVudFwiICkpO1xuICAgIChtZXRob2QuaW5wdXRTb2FwID09PSAnZW5jb2RlZCcpICYmIChlbmNvZGluZyA9ICdzb2FwOmVuY29kaW5nU3R5bGU9XCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy9zb2FwL2VuY29kaW5nL1wiICcpO1xuICB9IGVsc2Uge1xuICAgIGFzc2VydC5vayghc3R5bGUgfHwgc3R5bGUgPT09ICdkb2N1bWVudCcsICdpbnZhbGlkIG1lc3NhZ2UgZGVmaW5pdGlvbiBmb3IgcnBjIHN0eWxlIGJpbmRpbmcnKTtcbiAgICAvLyBwYXNzIGBpbnB1dC4kbG9va3VwVHlwZWAgaWYgYGlucHV0LiR0eXBlYCBjb3VsZCBub3QgYmUgZm91bmRcbiAgICBtZXNzYWdlID0gc2VsZi53c2RsLm9iamVjdFRvRG9jdW1lbnRYTUwoaW5wdXQuJG5hbWUsIGFyZ3MsIGlucHV0LnRhcmdldE5TQWxpYXMsIGlucHV0LnRhcmdldE5hbWVzcGFjZSwgKGlucHV0LiR0eXBlIHx8IGlucHV0LiRsb29rdXBUeXBlKSk7XG4gIH1cbiAgeG1sID0gXCI8P3htbCB2ZXJzaW9uPVxcXCIxLjBcXFwiIGVuY29kaW5nPVxcXCJ1dGYtOFxcXCI/PlwiICtcbiAgICBcIjxcIiArIGVudmVsb3BlS2V5ICsgXCI6RW52ZWxvcGUgXCIgK1xuICAgIHhtbG5zU29hcCArIFwiIFwiICtcbiAgICBcInhtbG5zOnhzaT1cXFwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcXFwiIFwiICtcbiAgICBlbmNvZGluZyArXG4gICAgdGhpcy53c2RsLnhtbG5zSW5FbnZlbG9wZSArICc+JyArXG4gICAgKChzZWxmLnNvYXBIZWFkZXJzIHx8IHNlbGYuc2VjdXJpdHkpID9cbiAgICAgIChcbiAgICAgICAgXCI8XCIgKyBlbnZlbG9wZUtleSArIFwiOkhlYWRlcj5cIiArXG4gICAgICAgIChzZWxmLnNvYXBIZWFkZXJzID8gc2VsZi5zb2FwSGVhZGVycy5qb2luKFwiXFxuXCIpIDogXCJcIikgK1xuICAgICAgICAoc2VsZi5zZWN1cml0eSAmJiAhc2VsZi5zZWN1cml0eS5wb3N0UHJvY2VzcyA/IHNlbGYuc2VjdXJpdHkudG9YTUwoKSA6IFwiXCIpICtcbiAgICAgICAgXCI8L1wiICsgZW52ZWxvcGVLZXkgKyBcIjpIZWFkZXI+XCJcbiAgICAgIClcbiAgICAgIDpcbiAgICAgICAgJydcbiAgICAgICkgK1xuICAgIFwiPFwiICsgZW52ZWxvcGVLZXkgKyBcIjpCb2R5XCIgK1xuICAgIChzZWxmLmJvZHlBdHRyaWJ1dGVzID8gc2VsZi5ib2R5QXR0cmlidXRlcy5qb2luKCcgJykgOiAnJykgK1xuICAgIChzZWxmLnNlY3VyaXR5ICYmIHNlbGYuc2VjdXJpdHkucG9zdFByb2Nlc3MgPyAnIElkPVwiXzBcIicgOiAnJykgK1xuICAgIFwiPlwiICtcbiAgICBtZXNzYWdlICtcbiAgICBcIjwvXCIgKyBlbnZlbG9wZUtleSArIFwiOkJvZHk+XCIgK1xuICAgIFwiPC9cIiArIGVudmVsb3BlS2V5ICsgXCI6RW52ZWxvcGU+XCI7XG5cbiAgaWYoc2VsZi5zZWN1cml0eSAmJiBzZWxmLnNlY3VyaXR5LnBvc3RQcm9jZXNzKXtcbiAgICB4bWwgPSBzZWxmLnNlY3VyaXR5LnBvc3RQcm9jZXNzKHhtbCwgZW52ZWxvcGVLZXkpO1xuICB9XG5cbiAgaWYob3B0aW9ucyAmJiBvcHRpb25zLnBvc3RQcm9jZXNzKXtcbiAgICB4bWwgPSBvcHRpb25zLnBvc3RQcm9jZXNzKHhtbCk7XG4gIH1cblxuICBzZWxmLmxhc3RNZXNzYWdlID0gbWVzc2FnZTtcbiAgc2VsZi5sYXN0UmVxdWVzdCA9IHhtbDtcbiAgc2VsZi5sYXN0RW5kcG9pbnQgPSBsb2NhdGlvbjtcblxuICBjb25zdCBlaWQgPSBvcHRpb25zLmV4Y2hhbmdlSWQgfHwgdXVpZDQoKTtcblxuICBzZWxmLmVtaXQoJ21lc3NhZ2UnLCBtZXNzYWdlLCBlaWQpO1xuICBzZWxmLmVtaXQoJ3JlcXVlc3QnLCB4bWwsIGVpZCk7XG5cbiAgY29uc3QgdHJ5SlNPTnBhcnNlID0gZnVuY3Rpb24oYm9keSkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gSlNPTi5wYXJzZShib2R5KTtcbiAgICB9XG4gICAgY2F0Y2goZXJyKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbiAgfTtcblxuICAvLyBpZiAodGhpcy5zdHJlYW1BbGxvd2VkICYmIHR5cGVvZiBzZWxmLmh0dHBDbGllbnQucmVxdWVzdFN0cmVhbSA9PT0gJ2Z1bmN0aW9uJykge1xuICAvLyAgIGNhbGxiYWNrID0gXy5vbmNlKGNhbGxiYWNrKTtcbiAgLy8gICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAvLyAgIHJlcSA9IHNlbGYuaHR0cENsaWVudC5yZXF1ZXN0U3RyZWFtKGxvY2F0aW9uLCB4bWwsIGhlYWRlcnMsIG9wdGlvbnMsIHNlbGYpO1xuICAvLyAgIHNlbGYubGFzdFJlcXVlc3RIZWFkZXJzID0gcmVxLmhlYWRlcnM7XG4gIC8vICAgY29uc3Qgb25FcnJvciA9IGZ1bmN0aW9uIG9uRXJyb3IoZXJyKSB7XG4gIC8vICAgICBzZWxmLmxhc3RSZXNwb25zZSA9IG51bGw7XG4gIC8vICAgICBzZWxmLmxhc3RSZXNwb25zZUhlYWRlcnMgPSBudWxsO1xuICAvLyAgICAgc2VsZi5sYXN0RWxhcHNlZFRpbWUgPSBudWxsO1xuICAvLyAgICAgc2VsZi5lbWl0KCdyZXNwb25zZScsIG51bGwsIG51bGwsIGVpZCk7XG4gIC8vICAgICBjYWxsYmFjayhlcnIsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHhtbCk7XG4gIC8vICAgfTtcbiAgLy8gICByZXEub24oJ2Vycm9yJywgb25FcnJvcik7XG4gIC8vICAgcmVxLm9uKCdyZXNwb25zZScsIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAvLyAgICAgcmVzcG9uc2Uub24oJ2Vycm9yJywgb25FcnJvcik7XG4gIC8vICAgICAvLyBXaGVuIHRoZSBvdXRwdXQgZWxlbWVudCBjYW5ub3QgYmUgbG9va2VkIHVwIGluIHRoZSB3c2RsLCBwbGF5IGl0IHNhZmUgYW5kXG4gIC8vICAgICAvLyBkb24ndCBzdHJlYW1cbiAgLy8gICAgIGlmKHJlc3BvbnNlLnN0YXR1c0NvZGUgIT09IDIwMCB8fCAhb3V0cHV0IHx8ICFvdXRwdXQuJGxvb2t1cFR5cGVzKSB7XG4gIC8vICAgICAgIGNvbnNvbGUubG9nKFwiVE9ETyEgcmVzcG9uc2UgaGFuZGxpbmdcIik7XG4gIC8vICAgICAgIC8vIHJlc3BvbnNlLnBpcGUoY29uY2F0U3RyZWFtKHtlbmNvZGluZzogJ3N0cmluZyd9LCBmdW5jdGlvbiAoYm9keSkge1xuICAvLyAgICAgICAvLyAgIHNlbGYubGFzdFJlc3BvbnNlID0gYm9keTtcbiAgLy8gICAgICAgLy8gICBzZWxmLmxhc3RSZXNwb25zZUhlYWRlcnMgPSByZXNwb25zZSAmJiByZXNwb25zZS5oZWFkZXJzO1xuICAvLyAgICAgICAvLyAgIHNlbGYubGFzdEVsYXBzZWRUaW1lID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgLy8gICAgICAgLy8gICBzZWxmLmVtaXQoJ3Jlc3BvbnNlJywgYm9keSwgcmVzcG9uc2UsIGVpZCk7XG4gIC8vICAgICAgIC8vICAgcmV0dXJuIHBhcnNlU3luYyhib2R5LCByZXNwb25zZSk7XG4gIC8vICAgICAgIC8vIH0pKTtcbiAgLy8gICAgICAgcmV0dXJuO1xuICAvLyAgICAgfVxuICAvLyAgICAgc2VsZi53c2RsLnhtbFRvT2JqZWN0KHJlc3BvbnNlLCBmdW5jdGlvbiAoZXJyb3IsIG9iaikge1xuICAvLyAgICAgICBzZWxmLmxhc3RSZXNwb25zZSA9IHJlc3BvbnNlO1xuICAvLyAgICAgICBzZWxmLmxhc3RSZXNwb25zZUhlYWRlcnMgPSByZXNwb25zZSAmJiByZXNwb25zZS5oZWFkZXJzO1xuICAvLyAgICAgICBzZWxmLmxhc3RFbGFwc2VkVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gIC8vICAgICAgIHNlbGYuZW1pdCgncmVzcG9uc2UnLCAnPHN0cmVhbT4nLCByZXNwb25zZSwgZWlkKTtcbiAgLy8gICAgICAgaWYgKGVycm9yKSB7XG4gIC8vICAgICAgICAgZXJyb3IucmVzcG9uc2UgPSByZXNwb25zZTtcbiAgLy8gICAgICAgICBlcnJvci5ib2R5ID0gJzxzdHJlYW0+JztcbiAgLy8gICAgICAgICBzZWxmLmVtaXQoJ3NvYXBFcnJvcicsIGVycm9yLCBlaWQpO1xuICAvLyAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnJvciwgcmVzcG9uc2UsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB4bWwpO1xuICAvLyAgICAgICB9XG4gIC8vICAgICAgIHJldHVybiBmaW5pc2gob2JqLCAnPHN0cmVhbT4nLCByZXNwb25zZSk7XG4gIC8vICAgICB9KTtcbiAgLy8gICB9KTtcbiAgLy8gICByZXR1cm47XG4gIC8vIH1cblxuICByZXR1cm4gKDxIdHRwQ2xpZW50PnNlbGYuaHR0cENsaWVudCkucG9zdChsb2NhdGlvbiwgeG1sLCB7XG4gICAgaGVhZGVyczogaGVhZGVycyxcbiAgICByZXNwb25zZVR5cGU6ICd0ZXh0Jywgb2JzZXJ2ZTogJ3Jlc3BvbnNlJyB9KS5waXBlKFxuICAgIG1hcCgocmVzcG9uc2U6IEh0dHBSZXNwb25zZTxhbnk+KSA9PiB7XG4gICAgICBzZWxmLmxhc3RSZXNwb25zZSA9IHJlc3BvbnNlLmJvZHk7XG4gICAgICBzZWxmLmxhc3RSZXNwb25zZUhlYWRlcnMgPSByZXNwb25zZSAmJiByZXNwb25zZS5oZWFkZXJzO1xuICAgICAgLy8gc2VsZi5sYXN0RWxhcHNlZFRpbWUgPSByZXNwb25zZSAmJiByZXNwb25zZS5lbGFwc2VkVGltZTtcbiAgICAgIHNlbGYuZW1pdCgncmVzcG9uc2UnLCByZXNwb25zZS5ib2R5LCByZXNwb25zZSwgZWlkKTtcbiAgICAgIHJldHVybiBwYXJzZVN5bmMocmVzcG9uc2UuYm9keSwgcmVzcG9uc2UpXG4gICAgfSlcbiAgKTtcblxuICAvLyByZXEgPSBzZWxmLmh0dHBDbGllbnQucmVxdWVzdChsb2NhdGlvbiwgeG1sLCBmdW5jdGlvbihlcnIsIHJlc3BvbnNlLCBib2R5KSB7XG4gIC8vICAgc2VsZi5sYXN0UmVzcG9uc2UgPSBib2R5O1xuICAvLyAgIHNlbGYubGFzdFJlc3BvbnNlSGVhZGVycyA9IHJlc3BvbnNlICYmIHJlc3BvbnNlLmhlYWRlcnM7XG4gIC8vICAgc2VsZi5sYXN0RWxhcHNlZFRpbWUgPSByZXNwb25zZSAmJiByZXNwb25zZS5lbGFwc2VkVGltZTtcbiAgLy8gICBzZWxmLmVtaXQoJ3Jlc3BvbnNlJywgYm9keSwgcmVzcG9uc2UsIGVpZCk7XG5cbiAgLy8gICBpZiAoZXJyKSB7XG4gIC8vICAgICBjYWxsYmFjayhlcnIsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHhtbCk7XG4gIC8vICAgfSBlbHNlIHtcbiAgLy8gICAgIHJldHVybiBwYXJzZVN5bmMoYm9keSwgcmVzcG9uc2UpO1xuICAvLyAgIH1cbiAgLy8gfSwgaGVhZGVycywgb3B0aW9ucywgc2VsZik7XG5cbiAgZnVuY3Rpb24gcGFyc2VTeW5jKGJvZHksIHJlc3BvbnNlOiBIdHRwUmVzcG9uc2U8YW55Pikge1xuICAgIGxldCBvYmo7XG4gICAgdHJ5IHtcbiAgICAgIG9iaiA9IHNlbGYud3NkbC54bWxUb09iamVjdChib2R5KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gIFdoZW4gdGhlIG91dHB1dCBlbGVtZW50IGNhbm5vdCBiZSBsb29rZWQgdXAgaW4gdGhlIHdzZGwgYW5kIHRoZSBib2R5IGlzIEpTT05cbiAgICAgIC8vICBpbnN0ZWFkIG9mIHNlbmRpbmcgdGhlIGVycm9yLCB3ZSBwYXNzIHRoZSBib2R5IGluIHRoZSByZXNwb25zZS5cbiAgICAgIGlmKCFvdXRwdXQgfHwgIW91dHB1dC4kbG9va3VwVHlwZXMpIHtcbiAgICAgICAgLy8gZGVidWcoJ1Jlc3BvbnNlIGVsZW1lbnQgaXMgbm90IHByZXNlbnQuIFVuYWJsZSB0byBjb252ZXJ0IHJlc3BvbnNlIHhtbCB0byBqc29uLicpO1xuICAgICAgICAvLyAgSWYgdGhlIHJlc3BvbnNlIGlzIEpTT04gdGhlbiByZXR1cm4gaXQgYXMtaXMuXG4gICAgICAgIGNvbnN0IGpzb24gPSBfLmlzT2JqZWN0KGJvZHkpID8gYm9keSA6IHRyeUpTT05wYXJzZShib2R5KTtcbiAgICAgICAgaWYgKGpzb24pIHtcbiAgICAgICAgICByZXR1cm4geyBlcnI6IG51bGwsIHJlc3BvbnNlLCByZXNwb25zZUJvZHk6IGpzb24sIGhlYWRlcjogdW5kZWZpbmVkLCB4bWwgfSAvL2NhbGxiYWNrKG51bGwsIHJlc3BvbnNlLCBqc29uLCB1bmRlZmluZWQsIHhtbCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVycm9yLnJlc3BvbnNlID0gcmVzcG9uc2U7XG4gICAgICBlcnJvci5ib2R5ID0gYm9keTtcbiAgICAgIHNlbGYuZW1pdCgnc29hcEVycm9yJywgZXJyb3IsIGVpZCk7XG4gICAgICB0aHJvdyBlcnJvcjsgLy9jYWxsYmFjayhlcnJvciwgcmVzcG9uc2UsIGJvZHksIHVuZGVmaW5lZCwgeG1sKTtcbiAgICB9XG4gICAgcmV0dXJuIGZpbmlzaChvYmosIGJvZHksIHJlc3BvbnNlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpbmlzaChvYmosIHJlc3BvbnNlQm9keSwgcmVzcG9uc2UpIHtcbiAgICBsZXQgcmVzdWx0ID0gbnVsbDtcblxuICAgIGlmICghb3V0cHV0KXtcbiAgICAgIC8vIG9uZS13YXksIG5vIG91dHB1dCBleHBlY3RlZFxuICAgICAgcmV0dXJuIHsgZXJyOiBudWxsLCByZXNwb25zZTogbnVsbCwgcmVzcG9uc2VCb2R5LCBoZWFkZXI6IG9iai5IZWFkZXIsIHhtbCB9OyAvL2NhbGxiYWNrKG51bGwsIG51bGwsIGJvZHksIG9iai5IZWFkZXIsIHhtbCk7XG4gICAgfVxuXG4gICAgLy8gSWYgaXQncyBub3QgSFRNTCBhbmQgU29hcCBCb2R5IGlzIGVtcHR5XG4gICAgaWYgKCFvYmouaHRtbCAmJiAhb2JqLkJvZHkpIHtcbiAgICAgIHJldHVybiAgeyBlcnI6IG51bGwsIG9iaiwgcmVzcG9uc2VCb2R5LCBoZWFkZXI6IG9iai5IZWFkZXIsIHhtbCB9OyBcbiAgICAgIC8vY2FsbGJhY2sobnVsbCwgb2JqLCBib2R5LCBvYmouSGVhZGVyKTtcbiAgICB9XG5cbiAgICBpZiggdHlwZW9mIG9iai5Cb2R5ICE9PSAnb2JqZWN0JyApIHtcbiAgICAgIGNvbnN0IGVycm9yOiBhbnkgPSBuZXcgRXJyb3IoJ0Nhbm5vdCBwYXJzZSByZXNwb25zZScpO1xuICAgICAgZXJyb3IucmVzcG9uc2UgPSByZXNwb25zZTtcbiAgICAgIGVycm9yLmJvZHkgPSByZXNwb25zZUJvZHk7XG4gICAgICByZXR1cm4geyBlcnI6IGVycm9yLCBvYmosIHJlc3BvbnNlQm9keSwgaGVhZGVyOiB1bmRlZmluZWQsIHhtbCB9OyBcbiAgICAgIC8vY2FsbGJhY2soZXJyb3IsIG9iaiwgYm9keSwgdW5kZWZpbmVkLCB4bWwpO1xuICAgIH1cblxuICAgIHJlc3VsdCA9IG9iai5Cb2R5W291dHB1dC4kbmFtZV07XG4gICAgLy8gUlBDL2xpdGVyYWwgcmVzcG9uc2UgYm9keSBtYXkgY29udGFpbiBlbGVtZW50cyB3aXRoIGFkZGVkIHN1ZmZpeGVzIEkuRS5cbiAgICAvLyAnUmVzcG9uc2UnLCBvciAnT3V0cHV0Jywgb3IgJ091dCdcbiAgICAvLyBUaGlzIGRvZXNuJ3QgbmVjZXNzYXJpbHkgZXF1YWwgdGhlIG91cHV0IG1lc3NhZ2UgbmFtZS4gU2VlIFdTREwgMS4xIFNlY3Rpb24gMi40LjVcbiAgICBpZighcmVzdWx0KXtcbiAgICAgIHJlc3VsdCA9IG9iai5Cb2R5W291dHB1dC4kbmFtZS5yZXBsYWNlKC8oPzpPdXQoPzpwdXQpP3xSZXNwb25zZSkkLywgJycpXTtcbiAgICB9XG4gICAgaWYgKCFyZXN1bHQpIHtcbiAgICAgIFsnUmVzcG9uc2UnLCAnT3V0JywgJ091dHB1dCddLmZvckVhY2goZnVuY3Rpb24gKHRlcm0pIHtcbiAgICAgICAgaWYgKG9iai5Cb2R5Lmhhc093blByb3BlcnR5KG5hbWUgKyB0ZXJtKSkge1xuICAgICAgICAgIHJldHVybiByZXN1bHQgPSBvYmouQm9keVtuYW1lICsgdGVybV07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4geyBlcnI6IG51bGwsIHJlc3VsdCwgcmVzcG9uc2VCb2R5LCBoZWFkZXI6IG9iai5IZWFkZXIsIHhtbCB9OyBcbiAgICAvL2NhbGxiYWNrKG51bGwsIHJlc3VsdCwgYm9keSwgb2JqLkhlYWRlciwgeG1sKTtcbiAgfVxuXG4gIC8vIC8vIEFkZGVkIG1vc3RseSBmb3IgdGVzdGFiaWxpdHksIGJ1dCBwb3NzaWJseSB1c2VmdWwgZm9yIGRlYnVnZ2luZ1xuICAvLyBpZihyZXEgJiYgcmVxLmhlYWRlcnMgJiYgIW9wdGlvbnMubnRsbSkgLy9maXhlcyBhbiBpc3N1ZSB3aGVuIHJlcSBvciByZXEuaGVhZGVycyBpcyB1bmRlZmluZWQsIGRvZXNuJ3QgYXBwbHkgdG8gbnRsbSByZXF1ZXN0c1xuICAvLyAgIHNlbGYubGFzdFJlcXVlc3RIZWFkZXJzID0gcmVxLmhlYWRlcnM7XG59O1xuIl19